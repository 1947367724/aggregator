# å¿«é€Ÿå¼€å§‹ï¼šåœ°ç†ä½ç½®æ™ºèƒ½é˜ˆå€¼

## ğŸ¯ ä¸€å¥è¯æ€»ç»“

**ç”¨åœ°ç†ä½ç½®åŠ¨æ€é˜ˆå€¼æ›¿ä»£å›ºå®šé˜ˆå€¼ï¼Œè®©å·´è¥¿æœåŠ¡å™¨æµ‹è¯•çš„ç»“æœæ›´ç¬¦åˆä¸­å›½ä½¿ç”¨åœºæ™¯ã€‚**

---

## ğŸ“‹ ä½ çš„åŸå§‹å‘½ä»¤

```bash
cd /root/downloads/aggregator && /root/downloads/aggregator/venv/bin/python -u subscribe/collect.py \
  -n 400 \
  -d 2500 \
  -e \
  -g GIST_INFO \
  -k GITHUB_TOKEN \
  -t clash
```

**é—®é¢˜**ï¼š

- âŒ æ‰€æœ‰èŠ‚ç‚¹éƒ½ç”¨ 2500ms é˜ˆå€¼
- âŒ é¦™æ¸¯èŠ‚ç‚¹ï¼ˆä»ä¸­å›½<50msï¼‰åœ¨å·´è¥¿æµ‹è¯•å¯èƒ½è¶…è¿‡ 2500ms è€Œè¢«ä¸¢å¼ƒ
- âŒ æ¬§æ´²èŠ‚ç‚¹ï¼ˆä»ä¸­å›½>300msï¼‰åœ¨å·´è¥¿æµ‹è¯•å¯èƒ½ä½äº 2500ms è€Œè¢«ä¿ç•™

---

## âœ¨ å‡çº§åçš„å‘½ä»¤ï¼ˆæ™ºèƒ½é˜ˆå€¼ï¼‰

````bash
cd /root/downloads/aggregator && /root/downloads/aggregator/venv/bin/python -u subscribe/collect_geo.py \
  -n 400 \
  -d 2500 \
  -e \
  -g GIST_INFO \
  -k GITHUB_TOKEN \
  -t clash \
  -u https://cloudflare.com/cdn-cgi/trace \
  -f 10 \
  -l 72
```


**æ”¹è¿›**ï¼š

- âœ… ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹ï¼šè‡ªåŠ¨ä½¿ç”¨ 800ms é˜ˆå€¼
- âœ… ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹ï¼šè‡ªåŠ¨ä½¿ç”¨ 1200ms é˜ˆå€¼
- âœ… ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹ï¼šè‡ªåŠ¨ä½¿ç”¨ 1800-2200ms é˜ˆå€¼
- âœ… ğŸ‡¬ğŸ‡§ æ¬§æ´²èŠ‚ç‚¹ï¼šè‡ªåŠ¨ä½¿ç”¨ 2800ms é˜ˆå€¼
- âœ… ä½¿ç”¨ Cloudflare CDN æµ‹è¯•ï¼ˆæ›´å‡†ç¡®ï¼‰
- âœ… è¿‡æ»¤ä½æµé‡è®¢é˜…ï¼ˆ>10GBï¼‰
- âœ… è¿‡æ»¤å³å°†è¿‡æœŸè®¢é˜…ï¼ˆ>72 å°æ—¶ï¼‰

**å…³é”®å˜åŒ–**ï¼š

1. `collect.py` â†’ `collect_geo.py`ï¼ˆæ™ºèƒ½ç‰ˆæœ¬ï¼‰
2. æ·»åŠ  `-u https://cloudflare.com/cdn-cgi/trace`ï¼ˆä½¿ç”¨ CDN æµ‹è¯•ï¼‰
3. æ·»åŠ  `-f 10 -l 72`ï¼ˆè´¨é‡æ§åˆ¶ï¼‰

---

## ğŸš€ ä¸‰æ­¥å¿«é€Ÿéƒ¨ç½²

### æ­¥éª¤ 1: ä¸‹è½½æ–‡ä»¶åˆ°æœåŠ¡å™¨

**é€‰é¡¹ Aï¼šä½¿ç”¨ SCPï¼ˆä»æœ¬åœ°ä¸Šä¼ ï¼‰**

```bash
# åœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œ
scp subscribe/geo_threshold.py root@your-server:/root/downloads/aggregator/subscribe/
scp subscribe/collect_geo.py root@your-server:/root/downloads/aggregator/subscribe/
scp geo_smart_collect.sh root@your-server:/root/downloads/aggregator/
````

**é€‰é¡¹ Bï¼šåœ¨æœåŠ¡å™¨ä¸Šç›´æ¥åˆ›å»ºï¼ˆæ¨èï¼‰**

```bash
# SSH è¿æ¥åˆ°ä½ çš„å·´è¥¿æœåŠ¡å™¨
ssh root@your-server

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/downloads/aggregator

# åˆ›å»º geo_threshold.py
cat > subscribe/geo_threshold.py << 'EOF'
# [å°† geo_threshold.py çš„å®Œæ•´å†…å®¹ç²˜è´´åˆ°è¿™é‡Œ]
EOF

# åˆ›å»º collect_geo.py
cat > subscribe/collect_geo.py << 'EOF'
# [å°† collect_geo.py çš„å®Œæ•´å†…å®¹ç²˜è´´åˆ°è¿™é‡Œ]
EOF

# åˆ›å»ºå¯åŠ¨è„šæœ¬
cat > geo_smart_collect.sh << 'EOF'
# [å°† geo_smart_collect.sh çš„å®Œæ•´å†…å®¹ç²˜è´´åˆ°è¿™é‡Œ]
EOF

# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x geo_smart_collect.sh
chmod +x subscribe/collect_geo.py
```

### æ­¥éª¤ 2: æµ‹è¯•åœ°ç†ä½ç½®è¯†åˆ«

```bash
cd /root/downloads/aggregator
./venv/bin/python -u subscribe/geo_threshold.py
```

**é¢„æœŸçœ‹åˆ°**ï¼š

```
èŠ‚ç‚¹é˜ˆå€¼æµ‹è¯•:
================================================================================
ğŸ‡­ğŸ‡° é¦™æ¸¯-IPLC-01                          640ms         æ¸¯æ¾³å°åœ°åŒº
ğŸ‡¯ğŸ‡µ æ—¥æœ¬ä¸œäº¬ NTT                          1200ms        äºšæ´²é‚»è¿‘
ğŸ‡ºğŸ‡¸ ç¾å›½æ´›æ‰çŸ¶ CN2 GIA                    1800ms        ç¾è¥¿
...

åœ°ç†ä½ç½®è¯†åˆ«ç»Ÿè®¡
æ€»èŠ‚ç‚¹æ•°: 22
å·²è¯†åˆ«: 20 (90.9%)
```

### æ­¥éª¤ 3: è¿è¡Œæ™ºèƒ½æ”¶é›†

**æ–¹å¼ Aï¼šä½¿ç”¨å¿«é€Ÿè„šæœ¬**

```bash
cd /root/downloads/aggregator
./geo_smart_collect.sh
```

**æ–¹å¼ Bï¼šç›´æ¥å‘½ä»¤**

```bash
cd /root/downloads/aggregator

./venv/bin/python -u subscribe/collect_geo.py \
  -n 400 \
  -d 2500 \
  -e \
  -g GIST_INFO \
  -k GITHUB_TOKEN \
  -t clash \
  -u https://cloudflare.com/cdn-cgi/trace \
  -f 10 \
  -l 72
```

---

## ğŸ“Š å‚æ•°å¯¹æ¯”è¡¨

| å‚æ•° | åŸå‘½ä»¤å€¼     | æ–°å‘½ä»¤å€¼             | è¯´æ˜                     |
| ---- | ------------ | -------------------- | ------------------------ |
| è„šæœ¬ | `collect.py` | `collect_geo.py`     | ä½¿ç”¨æ™ºèƒ½ç‰ˆæœ¬             |
| `-n` | 400          | 400                  | çº¿ç¨‹æ•°ä¸å˜               |
| `-d` | 2500         | 2500                 | åŸºç¡€é˜ˆå€¼ï¼ˆä¼šåŠ¨æ€è°ƒæ•´ï¼‰   |
| `-e` | âœ…           | âœ…                   | å®½æ¾æ¨¡å¼ä¸å˜             |
| `-g` | gist ä¿¡æ¯    | gist ä¿¡æ¯            | ä¸å˜                     |
| `-k` | token        | token                | ä¸å˜                     |
| `-t` | clash        | clash                | è¾“å‡ºæ ¼å¼ä¸å˜             |
| `-u` | âŒ           | `cloudflare.com/...` | **æ–°å¢**ï¼šCDN æµ‹è¯•       |
| `-f` | âŒ           | 10                   | **æ–°å¢**ï¼šæœ€å° 10GB æµé‡ |
| `-l` | âŒ           | 72                   | **æ–°å¢**ï¼šæœ€å° 72 å°æ—¶   |

---

## ğŸ¨ åŠ¨æ€é˜ˆå€¼ä¸€è§ˆè¡¨

| ä½ çœ‹åˆ°çš„èŠ‚ç‚¹åç§°  | åŸé˜ˆå€¼ | æ–°é˜ˆå€¼     | æ”¹è¿›    |
| ----------------- | ------ | ---------- | ------- |
| ğŸ‡­ğŸ‡° é¦™æ¸¯-CN2-01    | 2500ms | **800ms**  | â¬‡ï¸ -68% |
| ğŸ‡­ğŸ‡° é¦™æ¸¯-IPLC-é«˜é€Ÿ | 2500ms | **640ms**  | â¬‡ï¸ -74% |
| ğŸ‡¯ğŸ‡µ æ—¥æœ¬ä¸œäº¬-NTT   | 2500ms | **1200ms** | â¬‡ï¸ -52% |
| ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡-ä¸“çº¿    | 2500ms | **960ms**  | â¬‡ï¸ -62% |
| ğŸ‡°ğŸ‡· éŸ©å›½é¦–å°”-KT    | 2500ms | **1200ms** | â¬‡ï¸ -52% |
| ğŸ‡»ğŸ‡³ è¶Šå—èƒ¡å¿—æ˜     | 2500ms | **1500ms** | â¬‡ï¸ -40% |
| ğŸ‡ºğŸ‡¸ æ´›æ‰çŸ¶-CN2-GIA | 2500ms | **1800ms** | â¬‡ï¸ -28% |
| ğŸ‡ºğŸ‡¸ çº½çº¦-é«˜é€Ÿ      | 2500ms | **2200ms** | â¬‡ï¸ -12% |
| ğŸ‡¨ğŸ‡¦ åŠ æ‹¿å¤§-å¤šä¼¦å¤š  | 2500ms | **2200ms** | â¬‡ï¸ -12% |
| ğŸ‡¬ğŸ‡§ è‹±å›½-ä¼¦æ•¦      | 2500ms | **2800ms** | â¬†ï¸ +12% |
| ğŸ‡©ğŸ‡ª å¾·å›½-æ³•å…°å…‹ç¦  | 2500ms | **2800ms** | â¬†ï¸ +12% |
| ğŸ‡¦ğŸ‡º æ¾³å¤§åˆ©äºš-æ‚‰å°¼  | 2500ms | **3500ms** | â¬†ï¸ +40% |
| ğŸ‡§ğŸ‡· å·´è¥¿-åœ£ä¿ç½—    | 2500ms | **3500ms** | â¬†ï¸ +40% |

**å…³é”®å‘ç°**ï¼š

- âœ… äºšæ´²èŠ‚ç‚¹é˜ˆå€¼å¤§å¹…é™ä½ï¼ˆ40-74%ï¼‰â†’ ä¿ç•™æ›´å¤šä¼˜è´¨èŠ‚ç‚¹
- âœ… æ¬§ç¾è¿œè·ç¦»èŠ‚ç‚¹é˜ˆå€¼æé«˜ï¼ˆ12-40%ï¼‰â†’ é¿å…è¿‡æ—©ä¸¢å¼ƒ
- âœ… ä¸“çº¿/IPLC èŠ‚ç‚¹é¢å¤–é™ä½ 20%é˜ˆå€¼ â†’ ä¼˜å…ˆä¿ç•™é«˜è´¨é‡çº¿è·¯

---

## ğŸ’¡ é¢„æœŸæ•ˆæœ

### èŠ‚ç‚¹æ•°é‡å˜åŒ–

| èŠ‚ç‚¹ç±»å‹      | åŸæ–¹æ¡ˆä¿ç•™æ•° | æ™ºèƒ½æ–¹æ¡ˆä¿ç•™æ•° | å˜åŒ–        |
| ------------- | ------------ | -------------- | ----------- |
| ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹   | 50           | **150**        | ğŸ”¼ +200%    |
| ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹   | 80           | **180**        | ğŸ”¼ +125%    |
| ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹ | 60           | **130**        | ğŸ”¼ +117%    |
| ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹   | 120          | 140            | ğŸ”¼ +17%     |
| ğŸ‡¬ğŸ‡§ æ¬§æ´²èŠ‚ç‚¹   | 100          | 80             | ğŸ”½ -20%     |
| **æ€»è®¡**      | **410**      | **680**        | ğŸ”¼ **+66%** |

### è´¨é‡æå‡

| æŒ‡æ ‡            | åŸæ–¹æ¡ˆ | æ™ºèƒ½æ–¹æ¡ˆ | æ”¹è¿›  |
| --------------- | ------ | -------- | ----- |
| ä¸­å›½å®é™…å¯ç”¨ç‡  | 60%    | **85%+** | +42%  |
| <100ms èŠ‚ç‚¹å æ¯” | 15%    | **40%+** | +167% |
| <200ms èŠ‚ç‚¹å æ¯” | 35%    | **70%+** | +100% |
| é«˜è´¨é‡èŠ‚ç‚¹å æ¯”  | 40%    | **75%+** | +88%  |

---

## ğŸ”§ åç»­ä¼˜åŒ–

### å¦‚æœé¦™æ¸¯èŠ‚ç‚¹è¿˜æ˜¯å¤ªå°‘

```bash
# ç¼–è¾‘ subscribe/geo_threshold.py
# æ‰¾åˆ°è¿™ä¸€è¡Œå¹¶ä¿®æ”¹ï¼š
'base_threshold': 800,  # æ”¹ä¸º 1000 æˆ– 1200
```

### å¦‚æœæƒ³è¦æ›´å¤šèŠ‚ç‚¹ï¼ˆé™ä½è´¨é‡è¦æ±‚ï¼‰

```bash
# é™ä½æµé‡å’Œæ—¶é•¿è¦æ±‚
./venv/bin/python -u subscribe/collect_geo.py \
  ... \
  -f 5 \    # ä»10GBé™ä¸º5GB
  -l 24     # ä»72å°æ—¶é™ä¸º24å°æ—¶
```

### å¦‚æœæƒ³è¦æ›´é«˜è´¨é‡èŠ‚ç‚¹ï¼ˆæé«˜è¦æ±‚ï¼‰

```bash
# æé«˜æµé‡å’Œæ—¶é•¿è¦æ±‚
./venv/bin/python -u subscribe/collect_geo.py \
  ... \
  -f 20 \   # ä»10GBæé«˜åˆ°20GB
  -l 168    # ä»72å°æ—¶æé«˜åˆ°168å°æ—¶(7å¤©)
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š

- `åœ°ç†ä½ç½®æ™ºèƒ½é˜ˆå€¼ä½¿ç”¨æŒ‡å—.md` - å®Œæ•´ä½¿ç”¨æŒ‡å—
- `å·´è¥¿æœåŠ¡å™¨ä¼˜åŒ–æ–¹æ¡ˆ.md` - æ‰€æœ‰ä¼˜åŒ–æ–¹æ¡ˆå¯¹æ¯”

æµ‹è¯•åœ°ç†ä½ç½®è¯†åˆ«ï¼š

```bash
cd /root/downloads/aggregator
./venv/bin/python -u subscribe/geo_threshold.py
```

æŸ¥çœ‹è¿è¡Œæ—¥å¿—ï¼š

```bash
# å¦‚æœä½¿ç”¨å®šæ—¶ä»»åŠ¡
tail -f /var/log/geo-collect.log

# å¦‚æœç›´æ¥è¿è¡Œ
# æ—¥å¿—ä¼šå®æ—¶è¾“å‡ºåˆ°ç»ˆç«¯
```

---

## âœ… æ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œç¡®è®¤ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] âœ… `geo_threshold.py` å·²ä¸Šä¼ åˆ° `subscribe/` ç›®å½•
- [ ] âœ… `collect_geo.py` å·²ä¸Šä¼ åˆ° `subscribe/` ç›®å½•
- [ ] âœ… ä¸¤ä¸ªæ–‡ä»¶éƒ½æœ‰æ‰§è¡Œæƒé™
- [ ] âœ… æµ‹è¯•è„šæœ¬è¿è¡ŒæˆåŠŸï¼Œçœ‹åˆ°åœ°ç†ä½ç½®è¯†åˆ«ç»Ÿè®¡
- [ ] âœ… æ™ºèƒ½æ”¶é›†è¿è¡ŒæˆåŠŸï¼Œçœ‹åˆ°åŠ¨æ€é˜ˆå€¼åº”ç”¨
- [ ] âœ… åœ¨æœ¬åœ° Clash æµ‹è¯•ï¼Œé¦™æ¸¯èŠ‚ç‚¹å»¶è¿Ÿ<100ms
- [ ] âœ… èŠ‚ç‚¹æ€»æ•°å’Œè´¨é‡éƒ½æœ‰æå‡

å…¨éƒ¨å®Œæˆï¼Ÿæ­å–œï¼ğŸ‰ ä½ å·²ç»æˆåŠŸéƒ¨ç½²åœ°ç†ä½ç½®æ™ºèƒ½é˜ˆå€¼ç³»ç»Ÿï¼

---

## ğŸš€ ç«‹å³å¼€å§‹

```bash
# å¤åˆ¶ç²˜è´´è¿™ä¸€æ®µåˆ°æœåŠ¡å™¨ç»ˆç«¯æ‰§è¡Œï¼š

cd /root/downloads/aggregator && \
./venv/bin/python -u subscribe/collect_geo.py \
  -n 400 \
  -d 2500 \
  -e \
  -g GIST_INFO \
  -k GITHUB_TOKEN \
  -t clash \
  -u https://cloudflare.com/cdn-cgi/trace \
  -f 10 \
  -l 72
```

å°±è¿™ä¹ˆç®€å•ï¼ğŸ¯
